
rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // By default, allow public read access to all files.
    // This is useful for profile pictures and other public assets.
    match /{allPaths=**} {
      allow read;
    }

    // Secure write operations. Only authenticated users can write to their own
    // designated 'profileImages' folder. This rule primarily serves as a
    // safeguard for any potential client-side upload attempts.
    // Server-side uploads using the Firebase Admin SDK (as implemented in the app)
    // will bypass these rules entirely, relying on IAM permissions instead.
    match /profileImages/{userId}/{fileName} {
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    // Deny all other write operations from the client side by default.
    // To allow other client-side uploads, add a specific match block above this one.
    match /{allPaths=**} {
      allow write: if false;
    }
  }
}
