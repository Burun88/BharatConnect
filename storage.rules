
rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o { // Matches all files in your bucket
    // Rules for profile images stored in profileImages/{userId}/{fileName}
    match /profileImages/{userId}/{fileName} {
      // Allow authenticated users to read any profile image (common for display purposes).
      // You can restrict this further if needed (e.g., only if they are a contact).
      allow read: if request.auth != null; 
      
      // Allow a user to write (upload, update, delete) to their own profile image path.
      allow write: if request.auth != null && 
                      request.auth.uid == userId &&
                      // Ensures the file being written is in their folder and typically
                      // named something like 'profileImage.jpg', 'profileImage.png'.
                      // The service function uses 'profileImage' as the base name.
                      fileName.matches('profileImage\\..+'); 
    }
  }
}
