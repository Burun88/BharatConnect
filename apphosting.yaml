# Settings to manage and configure a Firebase App Hosting backend.
# https://firebase.google.com/docs/app-hosting/configure

# --- PERMISSIONS GUIDE ---
# If your app needs to access other Google Cloud services (like Storage, Firestore Admin, etc.),
# you must grant permissions to the App Hosting service account.

# 1. FIND YOUR SERVICE ACCOUNT:
#    - Go to the IAM & Admin page in Google Cloud Console: https://console.cloud.google.com/iam-admin/iam
#    - Find the principal with the email: service-YOUR_PROJECT_NUMBER@gcp-sa-apphosting.iam.gserviceaccount.com

# 2. GRANT SECRET ACCESS:
#    - For EACH secret below, go to Secret Manager, create a secret with the specified name (e.g., FIREBASE_API_KEY),
#    - paste the correct value into it, then go to the secret's PERMISSIONS tab,
#    - and grant the 'Secret Manager Secret Accessor' role to the service account from Step 1.
#    - This allows the build process to access your environment variables.

# 3. GRANT STORAGE ACCESS (To Fix `storage/unknown` Upload Errors):
#    - Go back to the IAM & Admin page.
#    - Find your App Hosting service account again and click the pencil icon (Edit principal).
#    - Click '+ ADD ANOTHER ROLE'.
#    - In the filter, search for and select the 'Storage Object Admin' role.
#    - Click 'Save'. This allows your running application to upload and delete files.
# --- END PERMISSIONS GUIDE ---

# Specifies the runtime configuration for the backend.
runConfig:
  maxInstances: 2

# Defines environment variables for the backend.
# For production, it's highly recommended to use Secret Manager for sensitive data.
# The 'secret' field specifies the name of the secret in Google Cloud Secret Manager.
env:
  - variable: NEXT_PUBLIC_FIREBASE_API_KEY
    secret: FIREBASE_API_KEY
    availability:
      - BUILD
      - RUNTIME
  - variable: NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN
    secret: FIREBASE_AUTH_DOMAIN
    availability:
      - BUILD
      - RUNTIME
  - variable: NEXT_PUBLIC_FIREBASE_PROJECT_ID
    secret: FIREBASE_PROJECT_ID
    availability:
      - BUILD
      - RUNTIME
  - variable: NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET
    secret: FIREBASE_STORAGE_BUCKET
    availability:
      - BUILD
      - RUNTIME
  - variable: NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID
    secret: FIREBASE_MESSAGING_SENDER_ID
    availability:
      - BUILD
      - RUNTIME
  - variable: NEXT_PUBLIC_FIREBASE_APP_ID
    secret: FIREBASE_APP_ID
    availability:
      - BUILD
      - RUNTIME
  - variable: NEXT_PUBLIC_FCM_VAPID_KEY
    secret: FCM_VAPID_KEY
    availability:
      - BUILD
      - RUNTIME
